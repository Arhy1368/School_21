#include <stdio.h>  // Подключение стандартной библиотеки ввода-вывода

#define W 80        // Определение ширины игрового поля
#define H 25        // Определение высоты игрового поля
#define PADDLE_HEIGHT 4  // Определение высоты ракетки
#define TRUE 1      // Константа для бесконечного цикла

// Функция рендеринга и игровой логики с передачей указателей на параметры
void r(int *a, int *b, int *x, int *y, int *dx, int *dy, int *s1, int *s2) {
    printf("\033[2J\033[H");  // Очистка экрана с помощью ANSI-escape последовательности

    // Внешний цикл отрисовки по вертикали
    for (int i = 0; i < H; printf("\n", i++)) {
        // Внутренний цикл отрисовки по горизонтали
        for (int j = 0; j < W; j++) {
            // Отрисовка левой и правой ракеток по вертикали
            if ((j == 1 && (i == *a || i == *a+1 || i == *a+2)) || 
                (j == W-2 && (i == *b || i == *b+1 || i == *b+2))) 
                printf("|");  // Вывод символа ракетки
            
            else if (j == *x && i == *y) 
                printf("o");  // Отрисовка мяча в текущей позиции
            
            // Проверка для отрисовки верхней и нижней границ
            else if ((i == 0 || i == H-1) && (j > 0 && j < W-1)) 
                printf("-");  // Вывод символа горизонтальной границы
            
            // Проверка для отрисовки боковых границ и центральной линии
            else if ((j == 0 || j == W-1 || j == W/2) && (i > 0 && i < H-1)) 
                printf("|");  // Вывод символа вертикальной границы
            
            else printf(" ");  // Заполнение пустого пространства
        }
    }
    
    printf("Player 1: %d | Player 2: %d\n", *s1, *s2);  // Вывод текущего счета игроков

    char ch = getchar();  // Получение символа управления с клавиатуры
    
    // Switch для обработки управления ракетками
    switch(ch) {
        case 'a':  // Движение левой ракетки вверх с проверкой верхней границы
            if (*a > 1) (*a)--; 
            break;
        case 'z':  // Движение левой ракетки вниз с проверкой нижней границы
            if (*a < H - PADDLE_HEIGHT) (*a)++; 
            break;
        case 'k':  // Движение правой ракетки вверх с проверкой верхней границы
            if (*b > 1) (*b)--; 
            break;
        case 'm':  // Движение правой ракетки вниз с проверкой нижней границы
            if (*b < H - PADDLE_HEIGHT) (*b)++; 
            break;
    }

    *x += *dx;  // Обновление горизонтальной координаты мяча
    *y += *dy;  // Обновление вертикальной координаты мяча

    // Проверка отскока от верхней и нижней границ
    if (*y <= 1 || *y >= H-2) {
        *dy = -*dy;  // Инверсия вертикального направления движения
    }

    // Проверка столкновения с левой и правой ракетками
    if ((*x == 2 && (*y >= *a && *y <= *a+2)) ||
        (*x == W-3 && (*y >= *b && *y <= *b+2))) {
        *dx = -*dx;  // Инверсия горизонтального направления движения
    }

    // Проверка попадания мяча за левую границу (гол второму игроку)
    if (*x < 1) { 
        (*s2)++;  // Увеличение счета второго игрока
        *x = W/2;  // Возврат мяча в центр по горизонтали
        *y = H/2;  // Возврат мяча в центр по вертикали
        *dx = -1;  // Установка начального горизонтального направления
        *dy = 1;   // Установка начального вертикального направления
    }

    // Проверка попадания мяча за правую границу (гол первому игроку)
    if (*x > W-2) { 
        (*s1)++;  // Увеличение счета первого игрока
        *x = W/2;  // Возврат мяча в центр по горизонтали
        *y = H/2;  // Возврат мяча в центр по вертикали
        *dx = 1;   // Установка начального горизонтального направления
        *dy = -1;  // Установка начального вертикального направления
    }
}

int main() {
    int a = H/2-1,  // Начальная Y-координата левой ракетки
        b = H/2-1,  // Начальная Y-координата правой ракетки
        x = W/2,    // Начальная X-координата мяча
        y = H/2,    // Начальная Y-координата мяча
        dx = -1,    // Начальное горизонтальное направление движения мяча
        dy = 1,     // Начальное вертикальное направление движения мяча
        s1 = 0,     // Счет первого игрока
        s2 = 0;     // Счет второго игрока
    
    // Основной игровой цикл до достижения 21 очка
    while (s1 < 21 && s2 < 21) {
        r(&a, &b, &x, &y, &dx, &dy, &s1, &s2);  // Вызов функции рендеринга и обработки игровой логики
    }
    
    printf(s1 == 21 ? "Player 1 wins!" : "Player 2 wins!");  // Вывод победителя
    return 0;  // Завершение программы с кодом 0
}